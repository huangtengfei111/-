# mysql 事务

https://www.cnblogs.com/yelbosh/p/5813865.html



mvcc 用一个事务中查询时，查到的是**InnoDB只查找版本早于（包含等于）当前事务版本的数据行** ，**行的删除版本要么未定义，要么大于当前事务版本号**

增删改如果是具体的行时会进行行锁，如果是一个条件时会进行表锁

update test set name='zs' where id=1; 行锁，update test set name='zs' where id>1;  表锁



事务a,b同时操作同一个表

a查询一次，2条数据，    b 插入一条数据

a查询一次，2条数据       b查询一次，3条数据

a更改该条数据 ，这条数据在a中可以改，但查不到

a查询一次，3条数据， 

```
select操作。a. InnoDB只查找版本早于（包含等于）当前事务版本的数据行。可以确保事务读取的行，要么是事务开始前就已存在，或者事务自身插入或修改的记录。b. 行的删除版本要么未定义，要么大于当前事务版本号。可以确保事务读取的行，在事务开始之前未删除。
insert操作。将新插入的行保存当前版本号为行版本号。
delete操作。将删除的行保存当前版本号为删除标识。
update操作。变为insert和delete操作的组合，insert的行保存当前版本号为行版本号，delete则保存当前版本号到原来的行作为删除标识。
　　由于旧数据并不真正的删除，所以必须对这些数据进行清理，innodb会开启一个后台线程执行清理工作，具体的规则是将删除版本号小于当前系统版本的行删除，这个过程叫做purge。
```



